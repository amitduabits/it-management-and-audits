# Dashboard Customization Guide

The Financial Data Visualizer generates interactive HTML dashboards using Plotly. This guide covers how to configure, customize, and extend the dashboard to fit your reporting needs.

---

## Quick Start

```bash
# Generate a dashboard from the sample data
python -m src.cli dashboard data/ -o reports/dashboard.html

# Open in your default browser
start reports/dashboard.html        # Windows
open reports/dashboard.html         # macOS
xdg-open reports/dashboard.html    # Linux
```

---

## CLI Options

```
python -m src.cli dashboard DATA_DIR [OPTIONS]

Arguments:
  DATA_DIR    Directory containing CSV datasets

Options:
  -o, --output TEXT    Output HTML file path (default: dashboard.html)
  -t, --title TEXT     Dashboard title (default: "Financial Data Dashboard")
  --theme TEXT         Visual theme: plotly_white, plotly_dark, plotly, ggplot2
  --help               Show this message and exit
```

### Theme Comparison

| Theme | Description | Best For |
|---|---|---|
| `plotly_white` | Clean white background with subtle grid | Print-friendly reports, presentations |
| `plotly_dark` | Dark background with light text | Screen-optimized dashboards, trading desks |
| `plotly` | Default Plotly theme with blue accents | General-purpose use |
| `ggplot2` | R-inspired theme with gray background | Data science audiences |

---

## Python API

```python
from src.dashboard import DashboardBuilder

builder = DashboardBuilder(
    data_dir="data/",
    title="Q4 2025 Financial Review",
    theme="plotly_white",
)

output_path = builder.build("reports/q4_review.html")
print(f"Dashboard saved to: {output_path}")
```

---

## What Gets Included

The dashboard auto-detects which datasets are present and builds the appropriate charts:

| Dataset File | Charts Generated |
|---|---|
| `transactions.csv` | Monthly transaction summary (bar), expense distribution (pie), outlier detection (scatter) |
| `market_data.csv` | OHLC candlestick with volume and moving averages |
| `revenue_expenses.csv` | Revenue/expenses/net income (line + bar), correlation heatmap |

If a dataset file is missing, those charts are simply omitted -- no errors.

---

## Customizing Charts

### Modifying Existing Charts

Edit the `DashboardBuilder` class in `src/dashboard.py`. Each chart is generated by a private method:

| Method | Chart |
|---|---|
| `_build_transaction_overview()` | Monthly transaction bar chart |
| `_build_category_breakdown()` | Expense pie/donut chart |
| `_build_outlier_scatter()` | Transaction outlier scatter |
| `_build_stock_price_chart()` | OHLC candlestick + volume |
| `_build_revenue_expenses_chart()` | Revenue, expenses, net income |
| `_build_correlation_heatmap()` | Correlation matrix |

Each method returns a `plotly.graph_objects.Figure`. You can modify colors, labels, layout, and traces within these methods.

### Adding a New Chart

1. Create a new method in `DashboardBuilder`:

```python
def _build_my_custom_chart(self) -> go.Figure:
    df = self._datasets.get("transactions")
    if df is None:
        return go.Figure()

    # Build your Plotly figure
    fig = go.Figure(
        go.Scatter(x=df["date"], y=df["amount"], mode="markers")
    )
    fig.update_layout(
        title="My Custom Chart",
        template=self.theme,
        height=500,
    )
    return fig
```

2. Register it in the `build()` method:

```python
charts.append(("my_custom", self._build_my_custom_chart()))
```

### Changing the Color Scheme

Modify the color constants in each chart builder method. Common Plotly color references:

- **Named colors:** `"#10B981"` (green), `"#EF4444"` (red), `"#2563EB"` (blue)
- **Plotly palettes:** `px.colors.qualitative.Set2`, `px.colors.sequential.Blues`
- **Continuous scales:** `"RdBu_r"`, `"Viridis"`, `"YlOrRd"`

---

## Modifying the HTML Template

The HTML structure is defined in `DashboardBuilder._render_template()`. You can customize:

### Header

```python
<header>
    <h1>{self.title}</h1>
    <p>Your custom subtitle here</p>
</header>
```

### Adding a Logo

Add an `<img>` tag to the header section:

```html
<header>
    <img src="https://your-company.com/logo.png" alt="Logo"
         style="height: 40px; margin-right: 1rem;">
    <h1>{self.title}</h1>
</header>
```

### Custom CSS

The dashboard includes inline CSS. Modify the `<style>` block in `_render_template()` to change:

- Fonts and typography
- Background colors and gradients
- Card styling (`.chart-container`)
- Responsive breakpoints

### Footer

Update the footer text for your organization:

```html
<footer>
    <p>Your Company Name -- Confidential Financial Report</p>
</footer>
```

---

## Embedding in Existing Pages

The charts can be embedded individually using Plotly's `to_html()` method:

```python
from src.dashboard import DashboardBuilder

builder = DashboardBuilder(data_dir="data/")
builder._load_datasets()

# Get a single chart as an HTML fragment
fig = builder._build_stock_price_chart()
html_fragment = fig.to_html(full_html=False, include_plotlyjs="cdn")

# Embed in your own template
with open("my_page.html", "w") as f:
    f.write(f"<div class='chart'>{html_fragment}</div>")
```

---

## Performance Considerations

| Dataset Size | Expected Build Time | File Size |
|---|---|---|
| < 1,000 rows per file | < 2 seconds | 1-3 MB |
| 1,000 - 10,000 rows | 2-5 seconds | 3-8 MB |
| 10,000 - 100,000 rows | 5-15 seconds | 8-25 MB |
| > 100,000 rows | Consider sampling | May exceed 50 MB |

### Tips for Large Datasets

1. **Sample data** before building: `df = df.sample(n=10000)`
2. **Aggregate** instead of plotting raw points: use daily/weekly totals
3. **Reduce Plotly traces**: fewer data series = smaller HTML
4. **Use `include_plotlyjs="cdn"`** to avoid embedding the 3MB Plotly library

---

## Sharing Dashboards

The generated HTML file is fully self-contained (Plotly JS loaded from CDN). To share:

1. **Email:** Attach the HTML file directly
2. **Internal server:** Copy to a web server directory
3. **Cloud storage:** Upload to S3, GCS, or Azure Blob with public access
4. **Offline:** Change `include_plotlyjs` to `True` in the template to embed the library

---

## Troubleshooting

| Issue | Solution |
|---|---|
| Charts not rendering | Ensure JavaScript is enabled in the browser; check network access to CDN |
| Blank charts | Verify dataset files exist and contain valid data |
| Dashboard too large | Reduce data size or limit chart count |
| Theme not applying | Check spelling of theme name in CLI or Python API |
| Date axis labels overlapping | Reduce data density or use `fig.update_xaxes(dtick="M1")` |
