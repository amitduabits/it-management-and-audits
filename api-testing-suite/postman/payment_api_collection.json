{
  "info": {
    "_postman_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    "name": "Payment Processing API",
    "description": "Complete collection for the Payment Processing API v2.4.0.\n\nIncludes endpoints for payments, refunds, webhooks, authentication, and health checks.\n\nAuthentication: Set the `api_key` variable in the environment and it will be used automatically via the collection-level authorization.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{api_key}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:5000/v1"
    }
  ],
  "item": [
    {
      "name": "Health & Info",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health",
              "host": ["{{base_url}}"],
              "path": ["health"]
            },
            "description": "Check API health status. No authentication required."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Service is healthy', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql('healthy');",
                  "});",
                  "",
                  "pm.test('Response time is acceptable', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(2000);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "API Info",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api-info",
              "host": ["{{base_url}}"],
              "path": ["api-info"]
            },
            "description": "Retrieve API metadata including version, supported currencies, and endpoint map."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Contains version info', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('version');",
                  "    pm.expect(jsonData).to.have.property('endpoints');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Payments",
      "item": [
        {
          "name": "Create Payment",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Idempotency-Key",
                "value": "{{$guid}}",
                "description": "Optional idempotency key to prevent duplicate charges"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"amount\": 49.99,\n    \"currency\": \"USD\",\n    \"description\": \"Order #12345 - Premium Widget\",\n    \"customer_email\": \"customer@example.com\",\n    \"payment_method\": \"card\",\n    \"metadata\": {\n        \"order_id\": \"12345\",\n        \"sku\": \"WIDGET-PRO-001\"\n    }\n}"
            },
            "url": {
              "raw": "{{base_url}}/payments",
              "host": ["{{base_url}}"],
              "path": ["payments"]
            },
            "description": "Create a new payment. The payment is processed immediately and the status is returned."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Payment created successfully', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([201, 402]);",
                  "});",
                  "",
                  "pm.test('Payment ID returned', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.match(/^pay_/);",
                  "    pm.collectionVariables.set('payment_id', jsonData.id);",
                  "});",
                  "",
                  "pm.test('Has required fields', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('amount');",
                  "    pm.expect(jsonData).to.have.property('currency');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Payment",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/payments/{{payment_id}}",
              "host": ["{{base_url}}"],
              "path": ["payments", "{{payment_id}}"]
            },
            "description": "Retrieve a specific payment by its ID."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Correct payment returned', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.eql(pm.collectionVariables.get('payment_id'));",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "List Payments",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/payments?page=1&per_page=10",
              "host": ["{{base_url}}"],
              "path": ["payments"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "per_page",
                  "value": "10"
                },
                {
                  "key": "status",
                  "value": "completed",
                  "disabled": true
                },
                {
                  "key": "currency",
                  "value": "USD",
                  "disabled": true
                }
              ]
            },
            "description": "List payments with pagination. Optionally filter by status and currency."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Returns list object', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.object).to.eql('list');",
                  "    pm.expect(jsonData).to.have.property('data');",
                  "    pm.expect(jsonData).to.have.property('pagination');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Payment Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/payments/{{payment_id}}/status",
              "host": ["{{base_url}}"],
              "path": ["payments", "{{payment_id}}", "status"]
            },
            "description": "Get the current status of a payment. Returns a compact status response."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Contains status field', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Cancel Payment",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/payments/{{payment_id}}/cancel",
              "host": ["{{base_url}}"],
              "path": ["payments", "{{payment_id}}", "cancel"]
            },
            "description": "Cancel a pending or processing payment. Completed payments cannot be cancelled."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Note: this will return 409 if payment is already completed",
                  "pm.test('Response has valid status code', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 409]);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Create Refund",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"amount\": 25.00,\n    \"reason\": \"requested_by_customer\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/payments/{{payment_id}}/refund",
              "host": ["{{base_url}}"],
              "path": ["payments", "{{payment_id}}", "refund"]
            },
            "description": "Create a full or partial refund for a completed payment."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Refund created', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([201, 409]);",
                  "});",
                  "",
                  "if (pm.response.code === 201) {",
                  "    pm.test('Refund has ID', function () {",
                  "        var jsonData = pm.response.json();",
                  "        pm.expect(jsonData.id).to.match(/^ref_/);",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Authentication",
      "item": [
        {
          "name": "OAuth2 - Authorize",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/oauth/authorize?client_id=my_app&redirect_uri=https://example.com/callback&response_type=code&scope=payments:read&state=random123",
              "host": ["{{base_url}}"],
              "path": ["oauth", "authorize"],
              "query": [
                {
                  "key": "client_id",
                  "value": "my_app"
                },
                {
                  "key": "redirect_uri",
                  "value": "https://example.com/callback"
                },
                {
                  "key": "response_type",
                  "value": "code"
                },
                {
                  "key": "scope",
                  "value": "payments:read"
                },
                {
                  "key": "state",
                  "value": "random123"
                }
              ]
            },
            "description": "Initiate an OAuth2 authorization flow. Returns an authorization code."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Authorization code returned', function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('authorization_code');",
                  "    pm.collectionVariables.set('auth_code', jsonData.authorization_code);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "OAuth2 - Token Exchange",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"grant_type\": \"authorization_code\",\n    \"code\": \"{{auth_code}}\",\n    \"client_id\": \"my_app\",\n    \"client_secret\": \"my_secret\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/oauth/token",
              "host": ["{{base_url}}"],
              "path": ["oauth", "token"]
            },
            "description": "Exchange an authorization code for an access token."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Token received', function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('access_token');",
                  "    pm.expect(jsonData.token_type).to.eql('Bearer');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "OAuth2 - Client Credentials",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"grant_type\": \"client_credentials\",\n    \"client_id\": \"my_service\",\n    \"client_secret\": \"service_secret\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/oauth/token",
              "host": ["{{base_url}}"],
              "path": ["oauth", "token"]
            },
            "description": "Obtain a token using client credentials (service-to-service authentication)."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Client credentials token received', function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('access_token');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Webhooks",
      "item": [
        {
          "name": "Register Webhook Endpoint",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{admin_api_key}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"url\": \"https://example.com/webhooks/payments\",\n    \"events\": [\n        \"payment.created\",\n        \"payment.completed\",\n        \"payment.failed\",\n        \"refund.completed\"\n    ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/webhooks/endpoints",
              "host": ["{{base_url}}"],
              "path": ["webhooks", "endpoints"]
            },
            "description": "Register a URL to receive webhook event notifications. Requires admin permissions."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Webhook registered', function () {",
                  "    pm.response.to.have.status(201);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('secret');",
                  "    pm.collectionVariables.set('webhook_id', jsonData.id);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "List Webhook Endpoints",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_api_key}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/webhooks/endpoints",
              "host": ["{{base_url}}"],
              "path": ["webhooks", "endpoints"]
            },
            "description": "List all registered webhook endpoints."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Returns list', function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.object).to.eql('list');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Delete Webhook Endpoint",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_api_key}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/webhooks/endpoints/{{webhook_id}}",
              "host": ["{{base_url}}"],
              "path": ["webhooks", "endpoints", "{{webhook_id}}"]
            },
            "description": "Delete a registered webhook endpoint."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Webhook deleted', function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.deleted).to.be.true;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "List Webhook Events",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/webhooks/events?limit=20",
              "host": ["{{base_url}}"],
              "path": ["webhooks", "events"],
              "query": [
                {
                  "key": "limit",
                  "value": "20"
                },
                {
                  "key": "type",
                  "value": "payment.completed",
                  "disabled": true
                }
              ]
            },
            "description": "List recent webhook events that have been fired."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Events listed', function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.object).to.eql('list');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Simulate Webhook Event",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{admin_api_key}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"event_type\": \"payment.completed\",\n    \"payload\": {\n        \"payment\": {\n            \"id\": \"pay_test123\",\n            \"amount\": 99.99,\n            \"currency\": \"USD\",\n            \"status\": \"completed\"\n        }\n    }\n}"
            },
            "url": {
              "raw": "{{base_url}}/webhooks/simulate",
              "host": ["{{base_url}}"],
              "path": ["webhooks", "simulate"]
            },
            "description": "Simulate firing a webhook event for testing purposes."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Webhook simulated', function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('event');",
                  "    pm.expect(jsonData).to.have.property('signature');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Admin",
      "item": [
        {
          "name": "Reset Test Data",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_api_key}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/test/reset",
              "host": ["{{base_url}}"],
              "path": ["test", "reset"]
            },
            "description": "Reset all test data. Requires admin API key."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Data reset successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('reset');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    }
  ]
}
