<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ report_title }}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif; background: #f1f5f9; color: #1e293b; }
        .page { max-width: 1100px; margin: 0 auto; padding: 30px; }

        .header {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #1e293b 100%);
            color: white; padding: 40px 50px; border-radius: 16px;
            margin-bottom: 30px; position: relative; overflow: hidden;
        }
        .header::after {
            content: ''; position: absolute; top: -50%; right: -10%;
            width: 400px; height: 400px; border-radius: 50%;
            background: rgba(59, 130, 246, 0.1);
        }
        .header h1 { font-size: 2em; margin-bottom: 8px; position: relative; z-index: 1; }
        .header .subtitle { opacity: 0.8; font-size: 0.95em; position: relative; z-index: 1; }
        .header .meta { display: flex; gap: 30px; margin-top: 20px; font-size: 0.88em; opacity: 0.7; position: relative; z-index: 1; }

        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .card {
            background: white; border-radius: 12px; padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08); transition: transform 0.2s;
        }
        .card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.12); }
        .card .label { font-size: 0.82em; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .card .value { font-size: 2.2em; font-weight: 700; line-height: 1.1; }
        .card .detail { font-size: 0.82em; color: #94a3b8; margin-top: 6px; }

        .section-title { font-size: 1.3em; font-weight: 600; margin: 30px 0 15px; padding-bottom: 10px; border-bottom: 2px solid #e2e8f0; }

        .risk-gauge {
            display: flex; align-items: center; gap: 30px;
            background: white; border-radius: 12px; padding: 30px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08); margin-bottom: 30px;
        }
        .gauge-circle {
            width: 120px; height: 120px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; flex-direction: column;
            font-weight: 700; color: white; flex-shrink: 0;
        }
        .gauge-circle .score { font-size: 2.2em; line-height: 1; }
        .gauge-circle .out-of { font-size: 0.75em; opacity: 0.8; }
        .gauge-info { flex: 1; }
        .gauge-info h3 { font-size: 1.2em; margin-bottom: 8px; }

        .risk-badge {
            display: inline-block; padding: 4px 14px; border-radius: 20px;
            color: white; font-weight: 600; font-size: 0.85em; text-transform: uppercase;
        }

        .severity-bar { display: flex; height: 12px; border-radius: 6px; overflow: hidden; margin: 15px 0; }
        .severity-bar .seg { transition: width 0.5s ease; }

        .compliance-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .compliance-card { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
        .compliance-card h4 { font-size: 0.95em; color: #475569; margin-bottom: 12px; }
        .compliance-score { font-size: 2.5em; font-weight: 700; margin-bottom: 6px; }
        .compliance-bar { height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; }
        .compliance-bar .fill { height: 100%; border-radius: 4px; transition: width 0.5s; }
        .compliance-stat { display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.82em; color: #64748b; }

        .recommendations { background: white; border-radius: 12px; padding: 30px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
        .rec-item {
            display: flex; gap: 15px; padding: 15px 0;
            border-bottom: 1px solid #f1f5f9;
        }
        .rec-item:last-child { border-bottom: none; }
        .rec-num {
            width: 36px; height: 36px; border-radius: 50%;
            background: #f1f5f9; display: flex; align-items: center;
            justify-content: center; font-weight: 700; color: #475569;
            flex-shrink: 0;
        }
        .rec-content { flex: 1; }
        .rec-content .rec-title { font-weight: 600; margin-bottom: 4px; }
        .rec-content .rec-desc { font-size: 0.88em; color: #64748b; }
        .rec-urgency {
            padding: 2px 10px; border-radius: 12px; font-size: 0.75em;
            font-weight: 600; text-transform: uppercase; height: fit-content;
        }
        .urgency-immediate { background: #fef2f2; color: #dc2626; }
        .urgency-short_term { background: #fff7ed; color: #ea580c; }
        .urgency-long_term { background: #f0fdf4; color: #16a34a; }

        .footer { text-align: center; padding: 25px; color: #94a3b8; font-size: 0.82em; margin-top: 30px; }
        .disclaimer { background: #fffbeb; border: 1px solid #fde68a; border-radius: 8px; padding: 15px 20px; margin-top: 20px; font-size: 0.85em; color: #92400e; }

        @media print {
            body { background: white; }
            .card:hover { transform: none; }
        }
    </style>
</head>
<body>
    <div class="page">
        <div class="header">
            <h1>{{ report_title }}</h1>
            <p class="subtitle">Comprehensive Security Posture Assessment</p>
            <div class="meta">
                <span>Organization: {{ organization }}</span>
                <span>Date: {{ report_date }}</span>
                <span>Report ID: {{ report_id }}</span>
                <span>Prepared by: {{ assessor }}</span>
            </div>
        </div>

        <!-- Risk Overview Gauge -->
        <div class="risk-gauge">
            <div class="gauge-circle" style="background: {{ risk_color }};">
                <span class="score">{{ overall_risk_score }}</span>
                <span class="out-of">/ 10</span>
            </div>
            <div class="gauge-info">
                <h3>Overall Risk Posture: <span class="risk-badge" style="background: {{ risk_color }};">{{ overall_risk_level | upper }}</span></h3>
                <p style="color: #64748b; margin-top: 8px;">
                    Based on automated scanning across network, application, DNS, and compliance domains.
                    {% if risk_trend == "improving" %}Risk trend is <strong style="color:#22c55e;">improving</strong>.
                    {% elif risk_trend == "worsening" %}Risk trend is <strong style="color:#ef4444;">worsening</strong>.
                    {% else %}Risk trend is <strong>stable</strong>.{% endif %}
                </p>
                <div class="severity-bar" style="margin-top: 15px;">
                    {% set total = severity_distribution.get('critical',0) + severity_distribution.get('high',0) + severity_distribution.get('medium',0) + severity_distribution.get('low',0) + severity_distribution.get('info',0) %}
                    {% if total > 0 %}
                    <div class="seg" style="width:{{ (severity_distribution.get('critical',0)/total*100)|round(1) }}%;background:#ef4444;"></div>
                    <div class="seg" style="width:{{ (severity_distribution.get('high',0)/total*100)|round(1) }}%;background:#f97316;"></div>
                    <div class="seg" style="width:{{ (severity_distribution.get('medium',0)/total*100)|round(1) }}%;background:#eab308;"></div>
                    <div class="seg" style="width:{{ (severity_distribution.get('low',0)/total*100)|round(1) }}%;background:#22c55e;"></div>
                    <div class="seg" style="width:{{ (severity_distribution.get('info',0)/total*100)|round(1) }}%;background:#94a3b8;"></div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="grid">
            <div class="card">
                <div class="label">Total Findings</div>
                <div class="value">{{ total_findings }}</div>
                <div class="detail">Across all scan types</div>
            </div>
            <div class="card">
                <div class="label">Critical</div>
                <div class="value" style="color: #ef4444;">{{ severity_distribution.get('critical', 0) }}</div>
                <div class="detail">Require immediate action</div>
            </div>
            <div class="card">
                <div class="label">High</div>
                <div class="value" style="color: #f97316;">{{ severity_distribution.get('high', 0) }}</div>
                <div class="detail">Address within 30 days</div>
            </div>
            <div class="card">
                <div class="label">Medium / Low</div>
                <div class="value" style="color: #eab308;">{{ severity_distribution.get('medium', 0) + severity_distribution.get('low', 0) }}</div>
                <div class="detail">Plan for remediation</div>
            </div>
        </div>

        <!-- Compliance Status -->
        <h2 class="section-title">Compliance Status</h2>
        <div class="compliance-grid">
            {% for fw in compliance_frameworks %}
            <div class="compliance-card">
                <h4>{{ fw.name }}</h4>
                <div class="compliance-score" style="color: {{ fw.color }};">{{ fw.score }}%</div>
                <div class="compliance-bar">
                    <div class="fill" style="width: {{ fw.score }}%; background: {{ fw.color }};"></div>
                </div>
                <div class="compliance-stat">
                    <span>Passed: {{ fw.passed }}</span>
                    <span>Partial: {{ fw.partial }}</span>
                    <span>Failed: {{ fw.failed }}</span>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Category Risk Breakdown -->
        <h2 class="section-title">Risk by Category</h2>
        <div class="grid" style="grid-template-columns: repeat(3, 1fr);">
            {% for cat in categories %}
            <div class="card">
                <div class="label">{{ cat.display_name }}</div>
                <div class="value" style="font-size:1.8em;">{{ cat.raw_score }}/10</div>
                <div class="detail">
                    {{ cat.finding_count }} findings |
                    Weight: {{ (cat.weight * 100)|round(0) }}%
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Top Recommendations -->
        <h2 class="section-title">Top Recommendations</h2>
        <div class="recommendations">
            {% for rec in recommendations %}
            <div class="rec-item">
                <div class="rec-num">{{ rec.priority }}</div>
                <div class="rec-content">
                    <div class="rec-title">{{ rec.category }}</div>
                    <div class="rec-desc">{{ rec.recommendation }}</div>
                </div>
                <span class="rec-urgency urgency-{{ rec.urgency }}">{{ rec.timeframe }}</span>
            </div>
            {% endfor %}
            {% if not recommendations %}
            <p style="color: #94a3b8; text-align: center; padding: 20px;">No critical recommendations at this time.</p>
            {% endif %}
        </div>

        <div class="disclaimer">
            <strong>Disclaimer:</strong> This report is based on automated scanning and analysis performed on {{ report_date }}.
            It provides a point-in-time assessment and should be supplemented with manual testing and expert review.
            Findings should be validated before implementing remediation actions. This tool is intended for authorized
            security assessments only.
        </div>

        <div class="footer">
            Generated by SecureAudit Pro | Report ID: {{ report_id }} | {{ report_date }}
        </div>
    </div>
</body>
</html>
